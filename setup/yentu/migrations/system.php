<?php
/**
 * Generated by yentu on 27th July, 2016 18:30:09
 */

begin()

    ->schema('system')
        
        ->table('roles')
            ->column('role_id')->type('integer')->nulls(false)
            ->column('role_name')->type('string')->nulls(false)
            ->primaryKey('role_id')->name('role_id_pkey')
            ->autoIncrement()
        
        ->table('users')
            ->column('user_id')->type('integer')->nulls(false)
            ->column('phone')->type('string')->nulls(true)
            ->column('email')->type('string')->nulls(false)
            ->column('user_status')->type('double')->nulls(true)
            ->column('other_names')->type('string')->nulls(true)
            ->column('last_name')->type('string')->nulls(false)
            ->column('first_name')->type('string')->nulls(false)
            ->column('role_id')->type('integer')->nulls(true)
            ->column('password')->type('string')->nulls(false)
            ->column('user_name')->type('string')->nulls(false)
            ->primaryKey('user_id')->name('user_id_pkey')
            ->autoIncrement()
            ->unique('user_name')->name('user_name_ukey')
        
        ->table('audit_trail')
            ->column('audit_trail_id')->type('integer')->nulls(false)
            ->column('data')->type('text')->nulls(true)
            ->column('type')->type('double')->nulls(false)
            ->column('audit_date')->type('timestamp')->nulls(false)
            ->column('description')->type('string')->nulls(false)
            ->column('item_type')->type('string')->nulls(false)
            ->column('item_id')->type('integer')->nulls(false)
            ->column('user_id')->type('integer')->nulls(false)
            ->primaryKey('audit_trail_id')->name('audit_trail_audit_id_pkey')
            ->autoIncrement()
            ->index('item_id')->name('audit_trail_item_id_idx')

        ->table('audit_trail_data')
            ->column('audit_trail_data_id')->type('integer')->nulls(false)            
            ->column('data')->type('text')->nulls(true)
            ->column('audit_trail_id')->type('integer')->nulls(false)
            ->primaryKey('audit_trail_data_id')->name('audit_trail_data_id_pkey')
            ->autoIncrement()
            ->index('audit_trail_id')->name('audit_trail_id_idx')
        
        ->table('permissions')
            ->column('permission_id')->type('integer')->nulls(false)
            ->column('module')->type('string')->nulls(true)
            ->column('value')->type('double')->nulls(false)
            ->column('permission')->type('string')->nulls(true)
            ->column('role_id')->type('integer')->nulls(false)
            ->primaryKey('permission_id')->name('perm_id_pkey')
            ->autoIncrement()
        
        ->table('api_keys')
            ->column('api_key_id')->type('integer')->nulls(false)
            ->column('secret')->type('string')->nulls(false)
            ->column('key')->type('string')->nulls(false)
            ->column('active')->type('boolean')->nulls(false)
            ->column('user_id')->type('integer')->nulls(false)
            ->primaryKey('api_key_id')->name('api_keys_pkey')
            ->autoIncrement()
        
        ->table('binary_objects')
            ->column('object_id')->type('integer')->nulls(false)
            ->column('data')->type('blob')->nulls(true)
            ->primaryKey('object_id')->name('binary_objects_pkey')
            ->autoIncrement()

        ->table('notes')
            ->column('note_id')->type('integer')->nulls(false)
            ->column('user_id')->type('integer')->nulls(false)
            ->column('item_type')->type('string')->nulls(false)
            ->column('item_id')->type('integer')->nulls(false)
            ->column('note_time')->type('timestamp')->nulls(false)
            ->column('note')->type('string')->nulls(true)
            ->primaryKey('note_id')->name('notes_note_id_pkey')
            ->autoIncrement()

        ->table('note_attachments')
            ->column('note_attachment_id')->type('integer')->nulls(false)
            ->column('object_id')->type('integer')->nulls(true)
            ->column('note_id')->type('integer')->nulls(true)
            ->column('description')->type('string')->nulls(true)
            ->primaryKey('note_attachment_id')->name('note_attachments_pkey')
            ->autoIncrement()

        ->table('notifications')
            ->column('notification_id')->type('integer')->nulls(false)
            ->column('subject')->type('string')->nulls(true)
            ->column('email')->type('text')->nulls(true)
            ->column('sms')->type('text')->nulls(true)
            ->column('tag')->type('string')->nulls(true)
            ->primaryKey('notification_id')->name('notifications_pkey')
            ->autoIncrement()

        ->table('configurations')            
            ->column('configuration_id')->type('integer')->nulls(false)
            ->column('key')->type('string')->nulls(false)
            ->column('value')->type('string')->nulls(true)
            ->column('user_id')->type('integer')->nulls(false)
            ->primaryKey('configuration_id')->name('configuration_id_pkey')
            ->autoIncrement()
            ->unique('key')->name('key_ukey')

    ->schema('system')->table('users')
        ->foreignKey('role_id')
        ->references(refSchema('system')->table('roles'))
        ->columns('role_id')
        ->name('users_role_id_fkey')
        
    ->schema('system')->table('permissions')
        ->foreignKey('role_id')
        ->references(refSchema('system')->table('roles'))
        ->columns('role_id')
        ->name('permissios_role_id_fkey')

    ->schema('system')->table('notes')
        ->foreignKey('user_id')
        ->references(refSchema('system')->table('users'))
        ->columns('user_id')
        ->name('notes_user_id_fkey')

    ->schema('system')->table('note_attachments')
        ->foreignKey('note_id')
        ->references(refSchema('system')->table('notes'))
        ->columns('note_id')
        ->name('note_attachments_note_id_fkey')
        
    ->schema('system')->table('api_keys')
        ->foreignKey('user_id')
        ->references(refSchema('system')->table('users'))
        ->columns('user_id')
        ->name('api_keys_user_id_fkey')

->end();
        